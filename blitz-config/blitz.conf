##########################################################################################
# modified: 2022-04-19 13:32:21 MSK
# comment: update config to encrypt secured params
##########################################################################################
{
    "blitz" : {
        "prod" : {
            "local" : {
                "idp" : {
                    "_captcha" : {
                        "reCAPTCHAv3" : {
                            "operations" : [
                                {
                                    "call" : {
                                        "headers" : [],
                                        "method" : "post",
                                        "url" : "https://www.google.com/recaptcha/api/siteverify?secret=${cfg.secret}&response=${ocp.response}"
                                    },
                                    "check" : {
                                        "errRegExp" : {},
                                        "okRegExp" : {
                                            "score" : "1\\.0|0\\.(5|6|7|8|9)",
                                            "success" : "true"
                                        }
                                    },
                                    "name" : "verify"
                                }
                            ],
                            "plainParams" : {
                                "sitekey" : "<SITE_KEY>"
                            },
                            "secureParams" : {
                                "secret" : "<SITE_SECRET>"
                            }
                        }
                    },
                    "_groups" : {
                        "profiles" : [
                            {
                                "attrsMap" : {
                                    "INN" : "inn",
                                    "OGRN" : "ogrn",
                                    "name" : "displayname"
                                },
                                "filter" : "objectClass=organizationgroup",
                                "groupStore" : "389-ds",
                                "id" : "orgs",
                                "type" : "mirror"
                            }
                        ],
                        "stores" : {
                            "list" : [
                                {
                                    "baseDN" : "ou=orgs,ou=groups,ou=sub,dc=test,dc=loc",
                                    "desc" : "Организации",
                                    "id" : "389-ds",
                                    "idAttrName" : "cn",
                                    "ldapStore" : "389-ds",
                                    "memberOfAttrName" : "memberOf",
                                    "membersAttrName" : "uniqueMember",
                                    "newGroupAttrs" : [
                                        {
                                            "attr" : "objectclass",
                                            "format" : "strings",
                                            "value" : "top,groupOfUniqueNames,organizationgroup"
                                        },
                                        {
                                            "attr" : "dn",
                                            "format" : "string",
                                            "value" : "cn=${id},ou=orgs,ou=groups,ou=sub,dc=test,dc=loc"
                                        }
                                    ],
                                    "searchScope" : "SUB",
                                    "type" : "ldap_based"
                                }
                            ]
                        }
                    },
                    "apps" : {
                        "_blitz_console" : {
                            "domain" : "https://blitz-demo.loc/blitz/console",
                            "name" : "custom.app.name._blitz_console"
                        },
                        "_blitz_idp" : {
                            "domain" : "https://blitz-demo.loc/blitz/idp",
                            "name" : "custom.app.name._blitz_idp"
                        },
                        "_blitz_profile" : {
                            "domain" : "https://blitz-demo.loc/blitz/profile",
                            "name" : "custom.app.name._blitz_profile"
                        },
                        "_blitz_recovery" : {
                            "disabled" : true,
                            "domain" : "https://blitz-demo.loc/blitz/recovery",
                            "name" : "custom.app.name._blitz_recovery"
                        },
                        "_blitz_reg" : {
                            "domain" : "https://blitz-demo.loc/blitz/reg",
                            "name" : "custom.app.name._blitz_reg"
                        }
                    },
                    "flexible-flows" : {
                        "login" : [
                            {
                                "appIds" : [],
                                "desc" : "Limited list of first factor methods for application",
                                "enabled" : false,
                                "source" : "flows/login/FFmethodsv1.java",
                                "sysname" : "FFmethods",
                                "version" : 1
                            },
                            {
                                "appIds" : [],
                                "desc" : "This procedures enables 2nd factor for the application",
                                "enabled" : false,
                                "source" : "flows/login/Require2ndFactorv1.java",
                                "sysname" : "Require2ndFactor",
                                "version" : 1
                            },
                            {
                                "appIds" : [],
                                "desc" : "If the user attribute \"appList\" (as an array) contains entityID (or client_id) of the application, access will be granted",
                                "enabled" : false,
                                "source" : "flows/login/AccessByAttributev1.java",
                                "sysname" : "AccessByAttribute",
                                "version" : 1
                            }
                        ]
                    },
                    "id-attrs" : {
                        "attrsMeta" : [
                            {
                                "format" : "string",
                                "name" : "sub",
                                "realmed" : false,
                                "required" : true,
                                "searchable" : true,
                                "source" : {
                                    "type" : "idStore"
                                },
                                "unique" : true
                            },
                            {
                                "format" : "string",
                                "name" : "family_name",
                                "realmed" : false,
                                "required" : false,
                                "searchable" : true,
                                "source" : {
                                    "type" : "idStore"
                                },
                                "unique" : false
                            },
                            {
                                "format" : "string",
                                "name" : "given_name",
                                "realmed" : false,
                                "required" : false,
                                "searchable" : true,
                                "source" : {
                                    "type" : "idStore"
                                },
                                "unique" : false
                            },
                            {
                                "format" : "string",
                                "name" : "middle_name",
                                "realmed" : false,
                                "required" : false,
                                "searchable" : true,
                                "source" : {
                                    "type" : "idStore"
                                },
                                "unique" : false
                            },
                            {
                                "format" : "string",
                                "name" : "email",
                                "realmed" : false,
                                "required" : false,
                                "searchable" : true,
                                "source" : {
                                    "transformer" : {
                                        "regexp" : "^(.+)@(.+).(.+)$",
                                        "subs" : "${0}"
                                    },
                                    "type" : "idStore"
                                },
                                "unique" : true
                            },
                            {
                                "format" : "string",
                                "name" : "phone_number",
                                "realmed" : false,
                                "required" : false,
                                "searchable" : true,
                                "source" : {
                                    "transformer" : {
                                        "regexp" : "^(\\+?)([78]?) ?\\(?([0-9]{3})\\)? ?([0-9]{3})[- ]?([0-9]{2})[- ]?([0-9]{2})$",
                                        "subs" : "+7(${3-})${4-}${5-}${6-}"
                                    },
                                    "type" : "idStore"
                                },
                                "unique" : true
                            }
                        ],
                        "displayName" : "${family_name} ${given_name-} ${middle_name-}, ${email-}",
                        "subjectIdAttr" : "sub"
                    },
                    "id-stores" : {
                        "list" : [
                            {
                                "desc" : "Built-in store",
                                "id" : "built-in",
                                "readOnly" : false,
                                "sizeLimit" : 100,
                                "type" : "BUILT-IN"
                            }
                        ]
                    },
                    "internal-store-cb" : {
                        "nodes" : [
                            "CB_NODES"
                        ],
                        "password" : "CB_PASSWORD",
                        "user" : "CB_USERNAME"
                    },
                    "internal-store-jdbc" : {
                        "conn_url" : "jdbc:postgresql://postgres:5432/blitzdb?user=blitz&password=${pswd}&loggerLevel=DEBUG",
                        "db_name" : "blitzdb",
                        "enc_params" : {
                            "pswd" : "{$}lHcl7GkVMfS5PxqO1BIMf2GywLsPtoVi037RX2v+BgJClxeLrsWmbg=="
                        },
                        "keyAlias" : "jdbc",
                        "pool" : {
                            "max_idle_conn" : 5,
                            "max_total_conn" : 20,
                            "max_wait_conn_ms" : 30000,
                            "min_idle_conn" : 1
                        }
                    },
                    "keystore" : {
                        "password" : "{$}pRlN964n0cblWFBKJ7FjU6y3tOPPDEBij6i1wRopiVmCOfCZ4xKTyg==",
                        "path" : "blitz-keystore.bks",
                        "type" : "bks"
                    },
                    "lang" : {
                        "ignore-browser" : true,
                        "languages" : [
                            "ru",
                            "en"
                        ],
                        "portal-lang-cookie" : {
                            "domain" : "blitz-demo.loc",
                            "name" : "blitzlng"
                        }
                    },
                    "license" : {
                        "key" : "MEQCIQCOF7xjWf8h8oKBsWbMbojvGUenTpb9XCHk9lHY2aAETAIfKGy9h0NNMq2Yz8HFXXfGK4MrX8PgHlsgnOGZCcUsqkUKRW50ZXJwcmlzZWUAWAoxNjcyNTIwMzk5cwBBAzk5OTEAYgAyAGMAcgBSADMA"
                    },
                    "logger" : {
                        "config-url" : "file:"${home}"/logback.xml",
                        "dir" : ${home}"/../logs",
                        "levels" : {
                            "ROOT" : "TRACE",
                            "application" : "TRACE",
                            "com.couchbase.client" : "INFO",
                            "com.identityblitz" : "TRACE",
                            "com.identityblitz.idp" : "TRACE",
                            "com.identityblitz.idp.events" : "INFO",
                            "com.identityblitz.idp.flow.dynamic" : "INFO",
                            "com.identityblitz.idp.flow.dynamic.extend" : "INFO",
                            "com.identityblitz.idp.rabbitmq" : "TRACE",
                            "com.identityblitz.idp.task.processing" : "INFO",
                            "com.identityblitz.login-framework" : "INFO",
                            "com.identityblitz.login-framework.ldap-timings" : "INFO",
                            "com.identityblitz.login.store" : "TRACE",
                            "com.identityblitz.play.memcached" : "INFO",
                            "com.identityblitz.play.memcached.RefreshableMemcachedConnection" : "INFO",
                            "com.unboundid.ldap.sdk" : "INFO",
                            "org.asynchttpclient.netty" : "TRACE",
                            "org.opensaml" : "INFO",
                            "org.opensaml.util.resource" : "INFO",
                            "play" : "TRACE",
                            "plugin.memcached" : "INFO"
                        }
                    },
                    "login" : {
                        "displayNameAttr" : "${email- }",
                        "factors" : [
                            [
                                {
                                    "enabled" : false,
                                    "method" : "spnego"
                                },
                                {
                                    "enabled" : true,
                                    "method" : "password"
                                },
                                {
                                    "enabled" : false,
                                    "method" : "x509"
                                },
                                {
                                    "enabled" : false,
                                    "method" : "tls"
                                },
                                {
                                    "enabled" : false,
                                    "method" : "externalIdps"
                                },
                                {
                                    "enabled" : true,
                                    "method" : "css"
                                },
                                {
                                    "enabled" : false,
                                    "method" : "cls"
                                },
                                {
                                    "enabled" : false,
                                    "method" : "sms"
                                },
                                {
                                    "enabled" : false,
                                    "method" : "webAuthn"
                                }
                            ],
                            [
                                {
                                    "enabled" : false,
                                    "method" : "hotp"
                                },
                                {
                                    "enabled" : false,
                                    "method" : "totp"
                                },
                                {
                                    "enabled" : false,
                                    "method" : "duo"
                                },
                                {
                                    "enabled" : false,
                                    "method" : "knownDevice"
                                },
                                {
                                    "enabled" : false,
                                    "method" : "sms"
                                },
                                {
                                    "enabled" : false,
                                    "method" : "email"
                                },
                                {
                                    "enabled" : false,
                                    "method" : "webAuthn"
                                }
                            ]
                        ],
                        "methods" : {
                            "css" : {
                                "cssScsInSec" : 300
                            },
                            "externalIdps" : {
                                "captcha" : {
                                    "_mode" : {
                                        "name" : "X-Captcha-Check",
                                        "type" : "on_header",
                                        "value" : "true"
                                    },
                                    "enabled" : false,
                                    "initJs" : "require(['/blitz/assets/blitz-common/javascripts/recaptcha_v3.js', 'captcha-conf'], function(captcha, conf){ captcha(conf);});",
                                    "mode" : {
                                        "type" : "always_on"
                                    },
                                    "name" : "reCAPTCHAv3"
                                }
                            },
                            "hotp" : {
                                "look-ahead-depth" : 10
                            },
                            "knownDevice" : {},
                            "password" : {
                                "bind" : [
                                    [
                                        {
                                            "attr" : "sub",
                                            "value" : "${login}"
                                        }
                                    ],
                                    [
                                        {
                                            "attr" : "email",
                                            "value" : "${login}"
                                        }
                                    ],
                                    [
                                        {
                                            "attr" : "phone_number",
                                            "value" : "${login}"
                                        }
                                    ]
                                ],
                                "captcha" : {
                                    "_mode" : {
                                        "name" : "X-Captcha-Check",
                                        "type" : "on_header",
                                        "value" : "true"
                                    },
                                    "enabled" : false,
                                    "initJs" : "require(['/blitz/assets/blitz-common/javascripts/recaptcha_v3.js', 'captcha-conf'], function(captcha, conf){ captcha(conf);});",
                                    "mode" : {
                                        "type" : "always_on"
                                    },
                                    "name" : "reCAPTCHAv3"
                                }
                            },
                            "sms" : {
                                "mobileAttr" : "phone_number",
                                "psw-expire-time-sec" : 300,
                                "psw-length" : 6
                            },
                            "webAuthn" : {
                                "bind" : [
                                    [
                                        {
                                            "attr" : "sub",
                                            "value" : "${login}"
                                        }
                                    ],
                                    [
                                        {
                                            "attr" : "email",
                                            "value" : "${login}"
                                        }
                                    ]
                                ],
                                "trustedAttestationModes" : [
                                    "FULL",
                                    "FULL_NO_ROOT",
                                    "SELF"
                                ]
                            }
                        },
                        "required-factor" : 1,
                        "sessionInactivityPeriodInSec" : 3600,
                        "sessionTtlInSec" : 10800,
                        "utilScs" : {
                            "encodingKey" : "fba725a78bf2135c2BCffcFB86DB2c7E",
                            "hmacKey" : "A1D4Ac7F90DFAbE18BB328b5b98DE984A54CEbFA",
                            "useCompression" : true
                        }
                    },
                    "logout" : {
                        "timeout-sec" : 2
                    },
                    "messages" : {
                        "dir" : "custom_messages",
                        "files" : [
                            "messages"
                        ]
                    },
                    "net" : {
                        "domain" : "blitz-demo.loc",
                        "trustedServers" : [
                            "0.0.0.0/0"
                        ]
                    },
                    "oauth" : {
                        "access-token-format" : "jwt",
                        "scopes" : [
                            {
                                "attrs" : [],
                                "description" : "Информация, позволяющая провести идентификацию и аутентификацию",
                                "name" : "openid"
                            },
                            {
                                "attrs" : [
                                    "family_name",
                                    "email",
                                    "phone_number",
                                    "sub",
                                    "middle_name",
                                    "given_name"
                                ],
                                "description" : "Основные данные профиля пользователя",
                                "name" : "profile"
                            },
                            {
                                "attrs" : [],
                                "client-level" : false,
                                "description" : "Получение настроек двухфакторной аутентификации, разрешений",
                                "name" : "blitz_api_usec"
                            },
                            {
                                "attrs" : [],
                                "client-level" : true,
                                "description" : "Изменение пароля, настроек двухфакторной аутентификации, отзыв разрешений любого пользователя",
                                "name" : "blitz_api_sys_usec_chg"
                            },
                            {
                                "attrs" : [],
                                "client-level" : true,
                                "description" : "Получение запомненных устройств любого пользователя",
                                "name" : "blitz_api_sys_uapps"
                            },
                            {
                                "attrs" : [],
                                "client-level" : false,
                                "description" : "Удаление запомненных устройств",
                                "name" : "blitz_api_uapps_chg"
                            },
                            {
                                "attrs" : [],
                                "client-level" : false,
                                "description" : "Получение событий безопасности",
                                "name" : "blitz_api_uaud"
                            },
                            {
                                "attrs" : [],
                                "client-level" : false,
                                "description" : "Изменение пароля, настроек двухфакторной аутентификации, отзыв разрешений",
                                "name" : "blitz_api_usec_chg"
                            },
                            {
                                "attrs" : [],
                                "client-level" : true,
                                "description" : "Удаление запомненных устройств любого пользователя",
                                "name" : "blitz_api_sys_uapps_chg"
                            },
                            {
                                "attrs" : [],
                                "client-level" : true,
                                "description" : "Получение событий безопасности любого пользователя",
                                "name" : "blitz_api_sys_uaud"
                            },
                            {
                                "attrs" : [],
                                "client-level" : true,
                                "description" : "Изменение атрибутов любого пользователя",
                                "name" : "blitz_api_sys_users_chg"
                            },
                            {
                                "attrs" : [],
                                "client-level" : false,
                                "description" : "Изменение атрибутов",
                                "name" : "blitz_api_user_chg"
                            },
                            {
                                "attrs" : [],
                                "client-level" : true,
                                "description" : "Получение атрибутов любого пользователя",
                                "name" : "blitz_api_sys_users"
                            },
                            {
                                "attrs" : [],
                                "client-level" : false,
                                "description" : "Получение запомненных устройств",
                                "name" : "blitz_api_uapps"
                            },
                            {
                                "attrs" : [],
                                "client-level" : true,
                                "description" : "Получение настроек двухфакторной аутентификации, разрешений любого пользователя",
                                "name" : "blitz_api_sys_usec"
                            },
                            {
                                "attrs" : [],
                                "client-level" : false,
                                "description" : "Получение атрибутов",
                                "name" : "blitz_api_user"
                            }
                        ]
                    },
                    "password-policy" : {
                        "_dicPath" : "/usr/share/identityblitz/blitz-config/password_dic.txt",
                        "groups" : [
                            {
                                "desc" : "password.policy.desc.digits",
                                "group" : "[0-9]",
                                "minCount" : 1
                            },
                            {
                                "desc" : "password.policy.desc.lowercase",
                                "group" : "[a-z]",
                                "minCount" : 1
                            },
                            {
                                "desc" : "password.policy.desc.capital",
                                "group" : "[A-Z]",
                                "minCount" : 1
                            },
                            {
                                "desc" : "password.policy.desc.special",
                                "group" : "[!@#$%^&*()+\\-?.,;:'`\"{}\\[\\]><=~/\\\\_]",
                                "minCount" : 1
                            }
                        ],
                        "maxPasswordAgeSec" : 2592000,
                        "minGroups" : 3,
                        "minLength" : 8,
                        "minPasswordAgeSec" : 86400,
                        "passwordHistoryLen" : 5
                    },
                    "provisioning" : {
                        "_remove" : {
                            "days" : 365,
                            "mode" : "keepRemovedId"
                        },
                        "recovery" : {
                            "recovery-contacts" : [
                                "phone_number",
                                "email"
                            ]
                        },
                        "registration" : {
                            "idStore" : "built-in",
                            "success-only-if" : []
                        }
                    },
                    "realms" : {
                        "list" : [
                            {
                                "name" : "social"
                            }
                        ]
                    },
                    "saml" : {
                        "idp-home" : "saml"
                    },
                    "simple" : {
                        "client-tag-cookie-name" : "domain2auth"
                    },
                    "tasks" : {
                        "broker-rmq" : {
                            "consumer" : {
                                "poolSize" : 2
                            },
                            "exchange" : "blitz.tasks",
                            "publisher" : {
                                "ackTimeout" : 15,
                                "channelsSize" : 8,
                                "poolSize" : 2
                            },
                            "server" : {
                                "host" : "rabbitmq",
                                "port" : 5672
                            },
                            "user" : {
                                "password" : "{$}3cZnjqueocBzEmlPOeHVeNEd9I0hpT1GScB9irncrt+BALFMX9IMyA==",
                                "username" : "blitz"
                            }
                        },
                        "executionRules" : [
                            {
                                "maxAttempts" : 2,
                                "queue" : "blitz.tasks.emails",
                                "redeliveryDelayInSec" : 60
                            }
                        ],
                        "queues" : [
                            {
                                "dequeueBatchSize" : 10,
                                "dequeuePeriodInSec" : 30,
                                "executorPoolSize" : 5,
                                "name" : "blitz.tasks.emails"
                            }
                        ]
                    },
                    "user-profile" : {
                        "check-session-interval" : 5,
                        "email-code-length" : 6,
                        "sms-code-exp-sec" : 300,
                        "sms-code-length" : 6,
                        "tabs" : [
                            "password",
                            "devices",
                            "events"
                        ],
                        "userNameAttr" : "${email- }"
                    },
                    "webAuthn" : {
                        "acceptedKeysAlgorithms" : [
                            -7,
                            -257
                        ],
                        "callTimeoutMs" : 60000,
                        "credentialsDiscoveryMode" : "SERVER",
                        "normalCounterDistance" : 1,
                        "rp" : {
                            "id" : "blitz-demo.loc",
                            "name" : "Identity Blitz"
                        },
                        "trustedStores" : [
                            {
                                "password" : "{$}20z0onxZ8Uj8rMfYd4M6LpJh2mJqfDp+o14YVTZBjawqc44TFlBwxQ==",
                                "path" : "webAuthn-trusted-ca.jks",
                                "type" : "jKS"
                            }
                        ],
                        "user" : {
                            "displayName" : "${family_name-}",
                            "name" : "${email-}"
                        }
                    }
                }
            }
        }
    },
    "home" : "/usr/share/identityblitz/blitz-config"
}
